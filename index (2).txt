<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-m">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychological Factors in Social Engineering</title>
    <!-- 1. Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar */
        .results-container::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .results-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .results-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .results-container::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        /* Simple spinning loader animation */
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        .loader {
            animation: spin 1s linear infinite;
        }
    </style>
    <!-- Import Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-100 min-h-screen p-4 md:p-8 flex flex-col">

    <div class="max-w-7xl mx-auto w-full">
        <header class="mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-slate-800 text-center">
                Psychological Factors and their influence in Social Engineering based on Undetected Vulnerabilities
            </h1>
            <p class="text-slate-500 text-center mt-2 text-lg">An Internal Database & Live Web Research Tool</p>
        </header>

        <!-- Main content grid -->
        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8 flex-grow">

            <!-- SECTION 1: INTERNAL DATABASE LOOKUP (SIMPLIFIED) -->
            <div class="bg-white rounded-xl shadow-2xl p-6 md:p-8 flex flex-col">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">Internal Database Lookup</h2>
                <p class="text-slate-500 mb-6">Data from "Psych factors.pdf" (Aniqa Afzal, 2025)</p>

                <!-- Control: Dropdown Select -->
                <div class="mb-6">
                    <label for="select-factor" class="block text-lg font-medium text-slate-700 mb-3">Select a Psychological Factor</label>
                    <select id="select-factor" class="w-full p-4 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-base">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>

                <!-- Result Display -->
                <div class="flex-grow flex items-center justify-center p-8 min-h-[150px] bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg shadow-xl">
                    <div class="text-center">
                        <div id="result-placeholder" class="text-blue-100 text-xl">Please select a factor</div>
                        <div id="result-value" class="hidden text-white font-extrabold text-7xl md:text-8xl"></div>
                        <div id="result-label" class="hidden text-blue-200 text-lg font-medium mt-1">% contribution in Social Engineering scams</div>
                    </div>
                </div>
            </div>

            <!-- SECTION 2: LIVE WEB RESEARCH -->
            <div class="bg-white rounded-xl shadow-2xl p-6 md:p-8 flex flex-col">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">Live Web Research</h2>
                <p class="text-slate-500 mb-6">Find external reports on data loss & financial impact.</p>
                
                <!-- Search Bar -->
                <div class="relative mb-4">
                    <input type="text" id="search-input" placeholder="e.g., 'urgency social engineering academic paper'" class="w-full p-4 pr-16 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-base">
                    <button id="search-button" class="absolute right-2 top-1/2 -translate-y-1/2 p-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                </div>
                
                <!-- Search Results Area -->
                <div id="search-results-container" class="results-container flex-grow mt-4 p-4 border border-slate-200 rounded-lg bg-slate-50 shadow-inner overflow-auto min-h-[400px]">
                    <!-- Loader -->
                    <div id="loader" class="hidden items-center justify-center flex-col h-full">
                        <svg class="loader h-12 w-12 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9H4V4m.582 5H9m11.418 2a8.003 8.003 0 01-15.356-2H15m.582 5H19v5h-.582m-15.356-2A8.001 8.001 0 0019.418 15H20v5h-.582m-5.6-1.582A8.003 8.003 0 014.582 15H9"/>
                        </svg>
                        <p class="text-slate-500 mt-4">Searching Google for academic papers & reports...</p>
                    </div>

                    <!-- Error Message -->
                    <div id="search-error" class="hidden items-center justify-center h-full">
                        <p class="text-red-500 text-center"></p>
                    </div>

                    <!-- Initial Prompt -->
                    <div id="search-prompt" class="flex items-center justify-center h-full">
                        <p class="text-slate-400 text-center text-lg">Search for real-time case studies and reports.</p>
                    </div>

                    <!-- Results -->
                    <div id="search-results" class="hidden">
                        
                        <!-- The list of sources appears first -->
                        <ol id="sources-list" class="flex flex-col gap-3 mb-6 pb-6 border-b border-slate-300 list-decimal list-inside pl-2">
                            <!-- Sources will be populated by JS -->
                        </ol>

                        <!-- Share Button and Summary -->
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-semibold text-slate-800">Research Summary</h4>
                            <button id="share-button" title="Share Results" class="hidden p-2 rounded-lg text-slate-500 hover:bg-slate-200 hover:text-blue-600 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                  <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
                                </svg>
                            </button>
                        </div>
                        
                        <p id="summary-text" class="text-slate-700 whitespace-pre-wrap"></p>
                        
                        <!-- Copy to Clipboard Notification -->
                        <div id="copy-notification" class="hidden text-sm text-green-600 font-medium text-right mt-4">
                            Copied to clipboard!
                        </div>

                    </div>
                </div>
            </div>

        </main>
    </div>

    <footer class="text-center text-slate-500 text-sm mt-8 pb-4">
        Copyrights 2025 Aniqa Afzal
    </footer>

    <script>
        // --- (A) INTERNAL DATABASE LOGIC ---

        // --- (A.1) DATA PRE-LOADED FROM YOUR PDF ---
        // This data is based on the "Psych factors.pdf"
        const sourceData = [
            { factorName: 'Multiple/unknown', percentage: 60 },
            { factorName: 'Authority', percentage: 59 },
            { factorName: 'Credibility', percentage: 48 },
            { factorName: 'Familiarity', percentage: 43 },
            { factorName: 'Following business', percentage: 28 },
            { factorName: 'Fear/Loss Aversion', percentage: 24 },
            { factorName: 'Legitimacy', percentage: 19 },
            { factorName: 'Curiosity', percentage: 16 },
            { factorName: 'Attraction', percentage: 11 },
            { factorName: 'Urgency', percentage: 11 },
            { factorName: 'Reverse SE', percentage: 11 },
            { factorName: 'Intimidation', percentage: 10 },
            { factorName: 'Liking', percentage: 8 },
            { factorName: 'Building rapport', percentage: 7 },
            { factorName: 'Reciprocity', percentage: 7 },
            { factorName: 'Expertise', percentage: 7 },
            { factorName: 'Greed', percentage: 6 },
            { factorName: 'Desire to help', percentage: 6 },
            { factorName: 'SSO, Data, Finance', percentage: 5 },
            { factorName: 'Opportunity', percentage: 4 },
            { factorName: 'Consistency', percentage: 4 },
            { factorName: 'Utility', percentage: 4 }
        ];

        // --- (A.2) Column/Key Definitions ---
        const keyFactor = 'factorName';
        const keyPercentage = 'percentage';

        // --- (A.3) DOM Elements (Internal) ---
        const selectFactor = document.getElementById('select-factor');
        const resultPlaceholder = document.getElementById('result-placeholder');
        const resultValue = document.getElementById('result-value');
        const resultLabel = document.getElementById('result-label');
        
        // --- (A.4) Initialization Function (Internal) ---
        function initializeInternalApp() {
            // Sort data alphabetically for the dropdown
            sourceData.sort((a, b) => a[keyFactor].localeCompare(b[keyFactor]));
            populateDropdown();
            selectFactor.addEventListener('change', findPercentage);
        }

        /** (A.5) Populates the dropdown */
        function populateDropdown() {
            selectFactor.innerHTML = '<option value="default">Select a factor...</option>';
            sourceData.forEach(item => {
                const option = document.createElement('option');
                option.value = item[keyFactor];
                option.textContent = item[keyFactor];
                selectFactor.appendChild(option);
            });
        }

        /** (A.7) Finds and displays the percentage */
        function findPercentage() {
            const selectedValue = selectFactor.value;
            resultPlaceholder.classList.add('hidden');
            resultValue.classList.add('hidden');
            resultLabel.classList.add('hidden');
            if (selectedValue === 'default') {
                resultPlaceholder.classList.remove('hidden');
                return;
            }
            const match = sourceData.find(row => row[keyFactor] === selectedValue);
            if (match) {
                resultValue.textContent = `${match[keyPercentage]}%`;
                resultValue.classList.remove('hidden');
                resultLabel.classList.remove('hidden');
            }
        }
        
        // --- (B) LIVE WEB SEARCH LOGIC ---

        // --- (B.1) DOM Elements (External) ---
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const loader = document.getElementById('loader');
        const searchError = document.getElementById('search-error');
        const searchPrompt = document.getElementById('search-prompt');
        const searchResults = document.getElementById('search-results');
        const summaryText = document.getElementById('summary-text');
        const sourcesList = document.getElementById('sources-list');
        const shareButton = document.getElementById('share-button');
        const copyNotification = document.getElementById('copy-notification');

        // --- (B.2) Event Listeners (External) ---
        searchButton.addEventListener('click', handleSearch);
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                handleSearch();
            }
        });

        /** (B.3) Main search handler */
        async function handleSearch() {
            const query = searchInput.value.trim();
            if (!query) return;

            // Reset UI
            showLoading(true);
            showError(null);
            showResults(false);
            searchPrompt.classList.add('hidden');
            copyNotification.classList.add('hidden');
            shareButton.classList.add('hidden'); // Hide share button on new search

            try {
                const response = await callGeminiAPI(query);
                if (response.text || (response.sources && response.sources.length > 0)) {
                    displayResults(response.text, response.sources);
                } else {
                    showError('No relevant results found for this specific query.');
                }
            } catch (error) {
                console.error('Search failed:', error);
                showError(error.message || 'Failed to fetch results. Please try again.');
            } finally {
                showLoading(false);
            }
        }

        /** (B.4) Calls the Gemini API with retries */
        async function callGeminiAPI(query) {
            const apiKey = ""; // API key is handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            // This system prompt instructs the AI to act as an academic researcher
            const systemPrompt = `You are an academic cybersecurity research assistant.
            Your purpose is to find and summarize scholarly articles, conference papers, and reports from known cybersecurity institutions (e.g., NIST, ENISA, ACM, IEEE).
            You MUST follow these rules:
            1.  Your summary MUST be a direct synthesis of the information found in the provided Google Search sources.
            2.  **This is the most important rule:** You MUST cite your sources using inline notations like [Source 1], [Source 2], etc.
            3.  Each notation must correspond to the numbered source in the 'Grounded Sources' list.
            4.  **When listing sources:** Prioritize academic papers and official reports. If a source is from a known academic database (e.g., 'ACM Digital Library', 'IEEE Xplore', 'Springer') or institution ('NIST', 'ENISA'), you MUST name it in the source title.
            5.  Example of a good source title: "[IEEE Xplore] A new framework for deepfake detection."
            6.  If no academic sources are found, you may use high-quality, reputable news reports as a secondary option.
            7.  Focus on:
                a) Clear definitions of psychological factors.
                b) Specific cases of financial or data loss from these attacks.`;


            const payload = {
                contents: [{ parts: [{ text: query }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                tools: [{ "google_search": {} }] // Enable Google Search grounding
            };

            let retries = 3;
            let delay = 1000;

            while (retries > 0) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429 || (response.status >= 500 && response.status < 600)) {
                        throw new Error(`Server error (status ${response.status}). Retrying...`);
                    }

                    if (!response.ok) {
                        const errorBody = await response.json();
                        throw new Error(`API Error: ${errorBody.error?.message || response.statusText}`);
                    }

                    const result = await response.json();
                    return processApiResponse(result);

                } catch (error) {
                    console.warn(error.message);
                    retries--;
                    if (retries === 0) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }
        
        /** (B.5) Processes the raw API response */
        function processApiResponse(result) {
            const candidate = result.candidates?.[0];
            if (!candidate) {
                if (result.promptFeedback && result.promptFeedback.blockReason) {
                    throw new Error(`Query blocked: ${result.promptFeedback.blockReason}`);
                }
                throw new Error('Invalid API response structure.');
            }
            
            if (candidate.finishReason === 'SAFETY' || candidate.finishReason === 'RECITATION') {
                 throw new Error('Response blocked for safety or recitation reasons.');
            }
            
            const text = candidate.content?.parts?.[0]?.text || null;
            let sources = [];
            const metadata = candidate.groundingMetadata;
            
            if (metadata && metadata.groundingAttributions) {
                sources = metadata.groundingAttributions
                    .map(attr => ({
                        uri: attr.web?.uri,
                        title: attr.web?.title
                    }))
                    .filter(source => source.uri && source.title);
            }
            
            return { text, sources };
        }

        /** (B.6) Displays the results in the UI */
        function displayResults(summary, sources) {
            sourcesList.innerHTML = ''; // Clear old sources
            if (sources.length > 0) {
                sources.forEach((source, i) => {
                    const li = document.createElement('li');
                    li.className = "p-3 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors ml-4"; 
                    
                    const a = document.createElement('a');
                    a.href = source.uri;
                    a.target = "_blank";
                    a.rel = "noopener noreferrer";
                    a.className = "flex items-center gap-3";
                    
                    const icon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                                  </svg>`;
                    
                    const textDiv = document.createElement('div');
                    const titleP = document.createElement('p');
                    titleP.className = "text-sm font-medium text-blue-700 truncate";
                    // The AI prompt will now try to add text like "[IEEE Xplore]" to the title string
                    titleP.textContent = source.title; 
                    
                    const uriP = document.createElement('p');
                    uriP.className = "text-xs text-slate-500 truncate";
                    uriP.textContent = source.uri;
                    
                    textDiv.appendChild(titleP);
                    textDiv.appendChild(uriP);
                    a.innerHTML = icon;
                    a.appendChild(textDiv);
                    li.appendChild(a);
                    sourcesList.appendChild(li);
                });
            } else {
                // REVISION: This is now blank, as requested.
                sourcesList.innerHTML = '';
            }

            // Display summary
            if (summary) {
                summaryText.textContent = summary;
                summaryText.classList.remove('hidden');
            } else {
                summaryText.textContent = 'No summary was generated, but you can review the sources above.';
                summaryText.classList.remove('hidden');
            }

            shareButton.classList.remove('hidden'); // Show the share button
            
            // Assign click handler for Share Button
            shareButton.onclick = () => {
                shareResults(summary, sources, searchInput.value);
            };

            showResults(true);
        }

        /** (B.7) Share Results Function */
        function shareResults(summary, sources, query) {
            const shareTitle = `Research: ${query}`;
            const shareURL = window.location.href; 
            const summarySnippet = summary ? `${summary.substring(0, 200)}...` : 'Check out this research';
            
            let sourcesText = sources.map((s, i) => `[Source ${i+1}] ${s.title}: ${s.uri}`).join('\n');
            const fullTextReport = `Research on: "${query}"\n\nResearch Summary:\n${summary || 'N/A'}\n\nGrounded Sources:\n${sourcesText}\n\nFound via Cybersecurity Factor Database: ${shareURL}`;
            
            if (navigator.share) {
                // Use Web Share API (Mobile)
                navigator.share({
                    title: shareTitle,
                    text: `${summarySnippet}\n\More:`,
                    url: shareURL,
                })
                .catch((error) => console.log('Error sharing:', error));
            } else {
                // Fallback to Clipboard (Desktop)
                copyToClipboard(fullTextReport);
            }
        }

        /** (B.8) Copy to Clipboard Utility */
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'absolute';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                copyNotification.classList.remove('hidden');
                setTimeout(() => {
                    copyNotification.classList.add('hidden');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy to clipboard:', err);
            }
            document.body.removeChild(textarea);
        }

        // --- (B.9) UI Helper Functions ---
        function showLoading(isLoading) {
            if (isLoading) {
                loader.classList.remove('hidden');
                loader.classList.add('flex');
            } else {
                loader.classList.add('hidden');
                loader.classList.remove('flex');
            }
        }

        function showError(message) {
            if (message) {
                searchError.querySelector('p').textContent = message;
                searchError.classList.remove('hidden');
                searchError.classList.add('flex');
            } else {
                searchError.classList.add('hidden');
                searchError.classList.remove('flex');
            }
        }

        function showResults(shouldShow) {
            if (shouldShow) {
                searchResults.classList.remove('hidden');
            } else {
                searchResults.classList.add('hidden');
            }
        }

        // --- (C) INITIALIZE THE APP ---
        document.addEventListener('DOMContentLoaded', initializeInternalApp);

    </script>
</body>
</html>

